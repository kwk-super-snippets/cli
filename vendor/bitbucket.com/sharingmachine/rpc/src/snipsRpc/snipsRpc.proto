syntax = "proto3";

option java_multiple_files = true;
option java_package = "io.kwk.service.snips";
option java_outer_classname = "SnipsRpc";

package snipsRpc;

service SnipsRpc {
    rpc Create (CreateRequest) returns (CreateResponse) {
    }
    rpc Update (UpdateRequest) returns (UpdateResponse) {
    }
    rpc Rename (RenameRequest) returns (RenameResponse) {
    }
    rpc Patch (PatchRequest) returns (PatchResponse) {
    }
    rpc Clone (CloneRequest) returns (CloneResponse) {
    }
    rpc Tag (TagRequest) returns (TagResponse) {
    }
    rpc UnTag (UnTagRequest) returns (UnTagResponse) {
    }
    rpc Get (GetRequest) returns (ListResponse) {
    }
    rpc List (ListRequest) returns (ListResponse) {
    }
    rpc Delete (DeleteRequest) returns (DeleteResponse) {
    }
}

message CreateRequest {
    string snip = 1;
    string fullName = 2;
    string description = 3;
    Role role = 4;
}

message UpdateRequest {
    string fullName = 1;
    string description = 2;
}

message RenameRequest {
    string fullName = 1;
    string newFullName = 2;
}

message RenameResponse {
    Snip snip = 1;
    string originalFullName = 2;
}

message PatchRequest {
    string fullName = 1;
    string target = 3;
    string patch = 2;
}

message PatchResponse {
    Snip snip = 1;
}

message UpdateResponse {
    Snip snip = 1;
}

message CloneRequest {
    string fullName = 1;
    string newFullName = 2;
    string username = 3;
}

message CloneResponse {
    Snip snip = 1;
}

message TagRequest {
    string fullName = 1;
    repeated string tags = 2;
    string username = 3;
}

message TagResponse {
    Snip snip = 1;
}

message UnTagRequest {
    string fullName = 1;
    repeated string tags = 2;
    string username = 3;
}

message UnTagResponse {
    Snip snip = 1;
}

message GetRequest {
    string fullName = 1;
    string username = 2;
}

message ListRequest {
    string username = 1;
    int64 since = 2;
    int64 size = 3;
    repeated string tags = 4;
    repeated string extensions = 5;
    bool all = 6;
}

message DeleteRequest {
    string fullName = 1;
    string username = 2;
}

message DeleteResponse {
    string fullName = 1;
}

message CreateResponse {
    Snip snip = 1;
    TypeMatchResponse typeMatch = 2;
}

message Snip {
    string snipId = 1;
    string fullName = 2;
    string username = 3;
    string name = 4;
    string extension = 5;
    string snip = 6;
    int64 snipVersion = 7;
    repeated string tags = 8;
    int64 created = 9;
    string description = 10;
    string clonedFromFullName = 11;
    int64 clonedFromVersion = 12;
    bool private = 13;
    int64 cloneCount = 14;
    int64 runCount = 15;
    string snipChecksum = 16;
    string snipSignature = 17;
    bool encrypted = 18;
    string algorithm = 19;
    Role role = 20;
}

enum Role {
    Standard = 0;
    Preferences = 1;
    Environment = 2;
}

message TypeMatchResponse {
    repeated MatchResponse matches = 1;
}

message MatchResponse {
    string extension = 1;
    int64 score = 2;
}

message ListResponse {
    repeated Snip items = 1;
    int64 total = 2;
    int64 since = 3;
    int64 size = 4;
}
