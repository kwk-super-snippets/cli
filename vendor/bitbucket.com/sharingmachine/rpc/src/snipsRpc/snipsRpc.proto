syntax = "proto3";

option java_multiple_files = true;
option java_package = "io.kwk.service.snips";
option java_outer_classname = "SnipsRpc";

package snipsRpc;

service SnipsRpc {
    rpc Create (CreateRequest) returns (CreateResponse) {
    }
    rpc Update (UpdateRequest) returns (UpdateResponse) {
    }
    rpc SetPreview (SetPreviewRequest) returns (SetPreviewResponse) {
    }
    rpc Move (MoveRequest) returns (MoveResponse) {
    }
    rpc Rename (RenameRequest) returns (RenameResponse) {
    }
    rpc Patch (PatchRequest) returns (PatchResponse) {
    }
    rpc Clone (CloneRequest) returns (CloneResponse) {
    }
    rpc Tag (TagRequest) returns (TagResponse) {
    }
    rpc UnTag (UnTagRequest) returns (UnTagResponse) {
    }
    rpc Get (GetRequest) returns (ListResponse) {
    }
    // Lists snippets in either a given pouch or as a flat list.
    // Tree view currently not supported.
    rpc List (ListRequest) returns (ListResponse) {
    }
    rpc Delete (DeleteRequest) returns (DeleteResponse) {
    }
    rpc Alpha (AlphaRequest) returns (AlphaResponse) {}
}

service PouchesRpc {
    // Lists the root of your kwk account. Includes pouches and snippets.
    rpc GetRoot (RootRequest) returns (RootResponse) {
    }
    rpc Create (CreatePouchRequest) returns (CreatePouchResponse) {
    }
    rpc Rename (RenamePouchRequest) returns (RenamePouchResponse) {
    }
    rpc MakePrivate (MakePrivateRequest) returns (MakePrivateResponse) {
    }
    rpc Delete (DeletePouchRequest) returns (DeletePouchResponse) {
    }
}

message AlphaRequest {
    string term = 1;
    string extension = 2;
    string username = 3;
    bool all = 4; // Search both private and public snippets.
    bool global = 5; // Search everyones snippets.
}

message AlphaResponse {
    repeated AlphaResult results = 1;
    int64 total = 2;
    int64 took = 3;
}

message AlphaResult {
    Snip snippet = 1;
    map<string, string> highlights = 2;
}

message CreatePouchRequest {
    string username = 1;
    string name  = 2;
    bool makePrivate = 3;
    bool encrypt = 4;
}

message SetPreviewRequest {
    Alias alias = 1;
    string preview = 2;
}

message SetPreviewResponse {
}

message CreatePouchResponse {
    string id = 1;
}

message RenamePouchRequest {
    string username = 1;
    string name = 2;
    string newName = 3;
}

message RenamePouchResponse {
    string originalName = 2;
    string name = 3;
}

message MakePrivateRequest {
    string username = 1;
    string name = 2;
    bool makePrivate = 3;
}

message MakePrivateResponse {
    bool isPrivate = 1;
}

message DeletePouchRequest {
    string username = 1;
    string name = 3;
}

message DeletePouchResponse {
}

message CreateRequest {
    string snip = 1;
    Alias alias = 2;
    string description = 3;
    Role role = 4;
}

message UpdateRequest {
    Alias alias = 1;
    string description = 2;
}

message MoveRequest {
    string username = 1;
    string sourcePouch = 2;
    string targetPouch = 3;
    repeated SnipName snipNames = 4;
}

message Alias {
    string username = 1;
    string pouch = 2;
    SnipName snipName = 3;
}

message SnipName {
    string name = 1;
    string extension = 2;
}

message MoveResponse {
    string pouch = 1;
}

message RenameRequest {
    Alias alias = 1;
    SnipName newName = 3;
}

message RenameResponse {
    Snip snip = 1;
    SnipName original = 2;
}

message PatchRequest {
    Alias alias = 1;
    string target = 2;
    string patch = 3;
}

message PatchResponse {
    Snip snip = 1;
}

message UpdateResponse {
    Snip snip = 1;
}

message CloneRequest {
    Alias alias = 1;
    Alias new = 2;
}

message CloneResponse {
    Snip snip = 1;
}

message TagRequest {
    Alias alias = 1;
    repeated string tags = 2;
}

message TagResponse {
    Snip snip = 1;
}

message UnTagRequest {
    Alias alias = 1;
    repeated string tags = 2;
}

message UnTagResponse {
    Snip snip = 1;
}

message GetRequest {
    Alias alias = 1;
}

message ListRequest {
    string username = 1;
    int64 since = 2;
    int64 size = 3;
    repeated string tags = 4;
    repeated string extensions = 5;
    bool all = 6;
    string pouch = 7;
}

message RootRequest {
    string username = 1;
    bool all = 2;
}

message RootResponse {
    repeated Snip snips = 1;
    repeated Pouch pouches = 2;
    repeated Pouch personal = 3;
    string Username = 4;
}

message DeleteRequest {
    string username = 1;
    string pouch = 2;
    repeated SnipName names = 3;
}

message DeleteResponse {
    repeated SnipName snipNames = 1;
}

message CreateResponse {
    Snip snip = 1;
    TypeMatchResponse typeMatch = 2;
}

message Pouch {
    string username = 1;
    string name = 2;
    bool makePrivate = 3;
    bool encrypt = 4;
    int64 snipCount = 5;
    repeated string sharedWith = 6;
    int64 modified = 7;
    string pouchId = 8;
}

message Snip {
    Alias alias = 1;
    string snipId = 2;
    string snip = 3;
    int64 snipVersion = 4;
    repeated string tags = 5;
    int64 created = 6;
    string description = 7;
    string clonedFromAlias = 8;
    int64 clonedFromVersion = 9;
    bool private = 10;
    int64 cloneCount = 11;
    int64 runCount = 12;
    string snipChecksum = 13;
    string snipSignature = 14;
    bool encrypted = 15;
    string algorithm = 16;
    Role role = 17;
}

enum Role {
    Standard = 0;
    Preferences = 1;
    Environment = 2;
    Message = 3;
}

message TypeMatchResponse {
    repeated MatchResponse matches = 1;
}

message MatchResponse {
    string extension = 1;
    int64 score = 2;
}

message ListResponse {
    repeated Snip items = 1;
    int64 total = 2;
    int64 since = 3;
    int64 size = 4;
    string pouch = 5;
    string username = 6;
}
