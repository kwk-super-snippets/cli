syntax = "proto3";

option java_multiple_files = true;
option java_package = "io.kwk.service.aliases";
option java_outer_classname = "AliasesRpc";

package aliasesRpc;

service AliasesRpc {
    rpc Create (CreateRequest) returns (CreateAliasResponse) {}
    rpc Update (UpdateRequest) returns (UpdateResponse) {}
    rpc Rename (RenameRequest) returns (RenameResponse) {}
    rpc Patch (PatchRequest) returns (PatchResponse) {}
    rpc Clone (CloneRequest) returns(CloneResponse) {}
    rpc Tag (TagRequest) returns(TagResponse) {}
    rpc UnTag (UnTagRequest) returns(UnTagResponse) {}
    rpc Get (GetRequest) returns(AliasListResponse) {}
    rpc List (ListRequest) returns(AliasListResponse) {}
    rpc Delete (DeleteRequest) returns(DeleteResponse) {}
}

message CreateRequest {
    string uri = 1;
    string fullKey = 2;
    string description = 3;
}

message UpdateRequest {
    string fullKey = 1;
    string description = 2;
}

message RenameRequest {
    string fullKey = 1;
    string newFullKey = 2;
}

message RenameResponse {
    AliasResponse alias = 1;
    string originalFullKey = 2;
}

message PatchRequest {
    string fullKey = 1;
    string target = 3;
    string patch = 2;
}

message PatchResponse {
    AliasResponse alias = 1;
}

message UpdateResponse {
    AliasResponse alias = 1;
}

message CloneRequest {
    string fullKey = 1;
    string newFullKey = 2;
    string username = 3;
}

message CloneResponse {
    AliasResponse alias = 1;
}

message TagRequest {
    string fullKey = 1;
    repeated string tags = 2;
    string username = 3;
}

message TagResponse {
    AliasResponse alias = 1;
}

message UnTagRequest {
    string fullKey = 1;
    repeated string tags = 2;
    string username = 3;
}

message UnTagResponse {
    AliasResponse alias = 1;
}

message GetRequest {
    string fullKey = 1;
    string username = 2;
}

message ListRequest {
    string username = 1;
    int64 since = 2;
    int64 size = 3;
    repeated string tags=4;
    repeated string runtimes=5;
}

message DeleteRequest {
    string fullKey = 1;
    string username = 2;
}

message DeleteResponse {
    string fullKey = 1;
}

message CreateAliasResponse {
    AliasResponse alias = 1;
    TypeMatchResponse typeMatch = 2;
}

message AliasResponse {
    string snipId = 1;
    string fullKey = 2;
    string username = 3;
    string key = 4;
    string extension = 6;
    string snip = 7;
    int64 snipVersion = 8;
    string runtime = 9;
    repeated string tags = 11;
    int64 created = 13;
    string description = 14;
    string forkedFromFullKey = 15;
    int64 forkedFromVersion = 16;
    bool private = 17;
    int64 cloneCount = 18;
    int64 runCount = 19;
}

message TypeMatchResponse {
    repeated MatchResponse matches = 1;
}

message MatchResponse {
    string media = 1;
    string runtime = 2;
    string extension = 3;
    int64 score = 4;
}

message AliasListResponse {
    repeated AliasResponse items = 1;
    int64 total = 2;
    int64 since = 3;
    int64 size = 4;
}
